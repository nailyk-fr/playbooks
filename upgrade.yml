- name: Upgrade all packages to the latest version
  hosts: all

  tasks:
    - ping: ~

    - name: Update APT package manager repositories cache
      become: true
      apt:
        update_cache: yes
      when: ( ( hostvars[inventory_hostname].ansible_distribution | search('Debian'))
            or ( hostvars[inventory_hostname].ansible_distribution | search('Devuan')) )

    - name: Upgrade installed packages
      become: true
      apt:
        upgrade: dist
      when: ( (hostvars[inventory_hostname].ansible_distribution | search('Debian'))
            or (hostvars[inventory_hostname].ansible_distribution | search('Devuan')) )
